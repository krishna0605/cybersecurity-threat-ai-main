/*
 * Basic malware detection rules 
 * These rules detect common malware patterns
 */

rule Suspicious_PowerShell_Commands {
    meta:
        description = "Detects suspicious PowerShell commands often used in scripts"
        author = "Security Team"
        severity = "medium"
        date = "2023-10-15"
    
    strings:
        $encode1 = "ToBase64String" nocase
        $encode2 = "-encodedcommand" nocase
        $encode3 = "-enc " nocase
        $download1 = "Net.WebClient" nocase
        $download2 = "DownloadFile" nocase
        $download3 = "DownloadString" nocase
        $download4 = "Invoke-WebRequest" nocase
        $execution1 = "Invoke-Expression" nocase
        $execution2 = "IEX" nocase
        $hidden1 = "-windowstyle hidden" nocase
        $hidden2 = "-w hidden" nocase
        
    condition:
        (any of ($encode*)) and (any of ($download*)) and (any of ($execution*) or any of ($hidden*))
}

rule Ransomware_File_Extensions {
    meta:
        description = "Detects common ransomware file extensions"
        author = "Security Team"
        severity = "high"
        date = "2023-10-15"
    
    strings:
        $ext1 = ".locked" nocase
        $ext2 = ".crypt" nocase
        $ext3 = ".crypted" nocase
        $ext4 = ".encrypted" nocase
        $ext5 = ".ransom" nocase
        $ext6 = ".wallet" nocase
        $ext7 = ".wcry" nocase
        $ext8 = ".wncry" nocase
        $ext9 = ".locky" nocase
        $ext10 = ".cerber" nocase
        
    condition:
        any of them
}

rule Keylogger_Behavior {
    meta:
        description = "Detects keylogger behavior"
        author = "Security Team"
        severity = "high"
        date = "2023-10-15"
    
    strings:
        $api1 = "GetAsyncKeyState" nocase
        $api2 = "GetKeyboardState" nocase
        $api3 = "SetWindowsHookEx" nocase
        $api4 = "WH_KEYBOARD" nocase
        $string1 = "keylog" nocase
        $string2 = "keystroke" nocase
        $string3 = "key press" nocase
        
    condition:
        (any of ($api*)) and (any of ($string*))
}

rule Suspicious_Obfuscation {
    meta:
        description = "Detects common obfuscation techniques"
        author = "Security Team"
        severity = "medium"
        date = "2023-10-15"
    
    strings:
        $chr = "chr(" nocase
        $concat = "&chr(" nocase
        $hex = "\\x"
        $escape = "\\u00"
        $concat2 = "+ \"" nocase
        $concat3 = "concat" nocase
        $eval = "eval(" nocase
        $execute = "execute(" nocase
        $fromCharCode = "fromCharCode" nocase
        
    condition:
        (3 of them) or
        (#hex > 20) or 
        (#escape > 20)
}

rule Backdoor_Shell_Commands {
    meta:
        description = "Detects common backdoor shell commands"
        author = "Security Team"
        severity = "high"
        date = "2023-10-15"
        
    strings:
        $cmd1 = "cmd.exe" nocase
        $cmd2 = "powershell.exe" nocase
        $cmd3 = "whoami" nocase
        $cmd4 = "net user" nocase
        $cmd5 = "net group" nocase
        $cmd6 = "tasklist" nocase
        $cmd7 = "netstat" nocase
        $cmd8 = "ipconfig" nocase
        $file_upload = "uploadFile" nocase
        $file_download = "downloadFile" nocase
        $remote = "RemoteShell" nocase
        $shell = "CreateShell" nocase
        
    condition:
        (any of ($cmd*)) and (any of ($file_upload, $file_download, $remote, $shell))
} 